/*
   -------------------------------------------------------------------------------------------
   AdPlayer v0.5.0.dev.100511
   Author: christopher.sancho@adtech.com, felix.ritter@adtech.com
   -------------------------------------------------------------------------------------------
  
   This file is part of AdPlayer v0.5.0.dev.100511.
   AdPlayer is free software: you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation, either version 3 of the License, or
   (at your option) any later version.
 
   AdPlayer is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
 
   You should have received a copy of the GNU General Public License
   along with AdPlayer.  If not, see <http://www.gnu.org/licenses/>.
  
  --------------------------------------------------------------------------------------------
*/
if(typeof AdPlayerManager==="undefined"){log=function(b,a){if(typeof(console)!=="undefined"&&console!=null){if(a){console.log("AdPlayer("+a+"): "+b)}else{console.log("AdPlayer: "+b)}}};var QueueItem=(function(){var _this={};_this.onReady=function(evalStr,context,readyFn,readyParams,errorFn,errorParams,search){if(!search){search=false}function waitTimer(eStr,cTxt,rdyFn,rdyPar,errFn,errPar){AdPlayerManager.searchCount++;var _timeout=0;function check(){_timeout++;if(_timeout==100){clearInterval(_interval);AdPlayerManager.searchCount--;errFn.apply(cTxt,errorParams);return}if(eval(eStr)){clearInterval(_interval);AdPlayerManager.searchCount--;rdyFn.apply(cTxt,rdyPar);return}}var _interval=setInterval(check,100)}if(search===true){waitTimer("AdPlayerManager.isSearching() === true",this,waitTimer,[evalStr,context,readyFn,readyParams,errorFn,errorParams],errorFn,errorParams)}else{waitTimer(evalStr,context,readyFn,readyParams,errorFn,errorParams)}};return _this});var AbstractPostMsg=(function(){var b={};var a;b.send=function(d,c){};b.receive=function(c){};return b});var PostMsgDefault=(function(){var b=new AbstractPostMsg();function a(){if(window.addEventListener){window.addEventListener("message",b.receive,false)}else{if(window.attachEvent){window.attachEvent("onmessage",b.receive)}}}b.send=function(d,c){c.postMessage(d,"*")};b.receive=function(c){json=PostMessage.deserialize(c.data);if(json.postType==PostMessage.OUTGOING){for(var d=0;d<document.getElementsByTagName("iframe").length;d++){if(document.getElementsByTagName("iframe")[d].contentWindow==c.source){var e=document.getElementsByTagName("iframe")[d];PostMessageHandler.domRefPlayerWait(e,json);break}}}else{if(json.postType==PostMessage.INCOMING){PostMessageHandler.inMsgHandler(json)}}};a();return b});var PostMessageHandler=(function(){var b=new QueueItem();b.domRefPlayerWait=function(e,c){b.dom=e;b.json=c;function d(j,h){var f=["postType:"+PostMessage.INCOMING,"uid:"+h.uid,"fn:iframePlayerVerify"];var g=b.getPlayerByDomSearch(j);if(g){if(h.fn=="iframePlayerVerify"){f.push("params:true");PostMessage.send(f,j.contentWindow);return}a(j,h,g)}else{f.push("params:false");PostMessage.send(f,j.contentWindow)}}b.onReady("_this.dom",this,d,[b.dom,b.json],null,null)};b.getPlayerByDomSearch=function(e){AdPlayerManager.searchCount++;var c=e.parentNode;while(!AdPlayerManager.getAdPlayerById(c.id)){c=c.parentNode;parName=c.nodeName.toLowerCase();if((parName=="body")||(parName=="html")){break}}if(c){var d=AdPlayerManager.getAdPlayerById(c.id);if(d){log("Found player at "+d.adDomElement().id);AdPlayerManager.searchCount--;return(d)}else{log('No AdPlayer found after parent search for "'+e.id+'."');AdPlayerManager.searchCount--;return null}}};function a(g,e,d){if(d){var j=e.params.split(",");for(var c=0;c<j.length;c++){switch(e.fn){case"addEventListener":if(unescape(j[c]).match(PostMessage.FUNCTION)){var h=unescape(j[c]).slice(PostMessage.FUNCTION.length);function f(k){var l=["postType:"+PostMessage.INCOMING,"uid:"+e.uid,"fn:"+h,"evtType:"+k.type(),"uidName:"+e.uidName];PostMessage.send(l,g.contentWindow)}f.uidName=e.uidName;j[c]=f}break}}switch(e.fn){case"removeEventListener":j.push(e.uidName.toString());break;case"track":adEvtObj=new AdEvent(j[0]);adEvtObj.target(d);adEvtObj.currentTarget(d);d.track(new AdEvent(j[0]),j[1]);return;break}d[e.fn].apply(d,j)}}b.inMsgHandler=function(e){switch(e.fn){case"iframePlayerVerify":var h;for(var d=0;d<AdPlayerManager.factoryList().length;d++){if(AdPlayerManager.factoryList()[d].uid()==e.uid){h=AdPlayerManager.factoryList()[d];break}}if(h){h.setIframePlayerType(e)}return;break;case"defaultTrackCallBack":break;default:var g=(new Function("return( "+e.fn+" );"))();var c=AdPlayerManager.getPlayerByUID(e.uid);if(c){var f=new AdEvent(e.evtType);f.target(c);g(f)}break}};return b})();var PostMessage=(function(){var c={};var a;c.OUTGOING="PostMessage.Outgoing";c.INCOMING="PostMessage.Incoming";c.FUNCTION="PostMessage.Function: ";function b(){if(typeof(window.postMessage)==typeof(Function)){a=new PostMsgDefault()}else{a=new AbstractPostMsg()}}c.send=function(d,e){d.push("pmsgid:"+new Date().getTime());var f=PostMessage.serialize(d);a.send(f,e)};c.serialize=function(d){var g="{";for(var f=0;f<d.length;f++){var e='"';e+=d[f].replace(/\s+/g,"");e=e.replace(":",'":"');if(f==(d.length-1)){e+='"'}else{e+='", '}g+=e}g+="}";return escape(g)};c.deserialize=function(f){_str=unescape(f);try{_str=(new Function("return( "+_str+" );"))()}catch(d){log("Could not deserialize.")}return _str};c.stringify=function(e){var d=[];for(i in e){var f=i+":"+e[i];d.push(f)}return c.serialize(d)};b();return c})();var PrivacyInfoButton=(function(h,a){var g={};g.button;g.iconPos="top-right";var b;var c;var e="Get Info";var f="privacyButton";g.openBtnTxt=function(j){if(j){e=j;if(c){c.innerHTML=e}}return e};function d(){g.openBtnTxt(a);g.button=document.createElement("div");AdPlayerManager.setClassName(g.button,f);b=document.createElement("div");AdPlayerManager.setClassName(b,"icon");g.button.appendChild(b);c=document.createElement("div");AdPlayerManager.setClassName(c,"text");c.style.display="none";g.button.appendChild(c);c.innerHTML=g.openBtnTxt();g.button.onclick=h;b.onmouseover=function(){c.style.display="block"};b.onmouseout=function(){c.style.display="none"}}g.setPosition=function(j){g.button.setAttribute("style","");b.setAttribute("style","");c.setAttribute("style","display: none;");g.button.style.position="absolute";g.button.style.zIndex="99999999";b.style.position="absolute";c.style.position="absolute";c.style.fontSize="12px";c.style.fontWeight="bold";c.style.width="100px";switch(j){case"bottom-left-out":g.button.style.bottom="0px";g.button.style.left="0px";b.style.left="0px";b.style.top="0px";c.style.left="16px";c.style.top="3px";c.style.textAlign="left";break;case"bottom-left":g.button.style.bottom="20px";g.button.style.left="0px";b.style.left="0px";b.style.top="0px";c.style.left="16px";c.style.top="3px";c.style.textAlign="left";break;case"bottom-right-out":g.button.style.bottom="0px";g.button.style.right="0px";b.style.right="0px";b.style.top="0px";c.style.right="20px";c.style.top="3px";c.style.textAlign="right";break;case"bottom-right":g.button.style.bottom="20px";g.button.style.right="0px";b.style.right="0px";b.style.top="0px";c.style.right="20px";c.style.top="3px";c.style.textAlign="right";break;case"top-right-out":g.button.style.top="-20px";g.button.style.right="0px";b.style.right="0px";b.style.top="0px";c.style.right="20px";c.style.top="3px";c.style.textAlign="right";break;case"top-right":g.button.style.top="0px";g.button.style.right="0px";b.style.right="0px";b.style.top="0px";c.style.right="20px";c.style.top="3px";c.style.textAlign="right";break;case"top-left-out":g.button.style.top="-20px";g.button.style.left="0px";b.style.left="0px";b.style.top="0px";c.style.left="16px";c.style.top="3px";c.style.textAlign="left";break;default:g.button.style.top="0px";g.button.style.left="0px";b.style.left="0px";b.style.top="0px";c.style.left="16px";c.style.top="3px";c.style.textAlign="left";break}AdPlayerManager.setClassName(g.button,f+" "+j)};d();return g});var PrivacyPanel=(function(j,t,b,e,g,c){var n={};n.panel;var p;var l;var m="privacyPanel";n.infoList=function(v){if(v){l=v;if(p){p.innerHTML="";for(var u=0;u<l.length;u++){k(l[u])}}}return l};var f;var d="X";n.closeTxt=function(u){if(u){d=u;if(d!=""){f.innerHTML=d}}return d};var q;var r="";n.headerTxt=function(u){if(u){r=u;if(q){q.innerHTML=r;if(r!=""){if(!s("div","header")){if(p){n.panel.insertBefore(q,p)}else{n.panel.appendChild(q)}}}}}return r};var h;var a="";n.footerTxt=function(u){if(u){a=u;if(h){h.innerHTML=a;if(a!=""){if(!s("div","footer")){n.panel.appendChild(h)}}}}return r};function o(){n.panel=document.createElement("div");AdPlayerManager.setClassName(n.panel,m);f=document.createElement("div");AdPlayerManager.setClassName(f,"close");f.innerHTML=n.closeTxt(t);f.onclick=g;n.panel.appendChild(f);q=document.createElement("div");AdPlayerManager.setClassName(q,"header");n.headerTxt(b);p=document.createElement("div");AdPlayerManager.setClassName(p,"list");n.panel.appendChild(p);n.infoList(j);h=document.createElement("div");AdPlayerManager.setClassName(h,"footer");n.footerTxt(e)}function k(u){var v=document.createElement("div");v.setAttribute("class","item");if(AdPlayerManager.isIE){v.setAttribute("className","item")}privacyClick=function(w){var x=new Object();x.url=w;c(new AdEvent(AdEvent.PRIVACY_CLICK,x));window.open(w)};v.innerHTML='<h4 style="margin:0; padding:0;">- <span>'+u.adServer+"</span></h4><p>"+u.message+"</p><p><a href=\"javascript:privacyClick('"+u.url+'\');" target="_self">'+u.urlText+"</a></p>";p.appendChild(v)}function s(v,w){for(var u=0;u<n.panel.getElementsByTagName(v).length;u++){if(n.panel.getElementsByTagName(v)[u].className==w){return n.panel.getElementsByTagName(v)[u]}}return null}n.setPosition=function(u){n.panel.setAttribute("style","");n.panel.style.position="absolute";n.panel.style.zIndex="999999999";switch(u){case"bottom-left-out":case"bottom-left":n.panel.style.bottom="0px";n.panel.style.left="0px";break;case"bottom-right-out":case"bottom-right":n.panel.style.bottom="0px";n.panel.style.right="0px";break;case"top-right-out":case"top-right":n.panel.style.top="0px";n.panel.style.right="0px";break;default:n.panel.style.top="0px";n.panel.style.left="0px";break}AdPlayerManager.setClassName(n.panel,m+" "+u)};o();return n});var PrivacyInfo=(function(){var a={};a.adServer="";a.message="";a.url="";a.urlText="";return a});var URLRequest=(function(a){var b={};b.url;if(a){b.url=a}b.load=function(){if(b.url){var d=document.createElement("img");d.src=(b.url);d.style.display="none";var c=document.getElementsByTagName("script")[0];log(b.url,"URLRequest");c.parentNode.insertBefore(d,c);c.parentNode.removeChild(d);delete d;delete c}else{log("URLRequest",'Parameter "url" is not defined.')}};return b});function AdEvent(d,f){var b="";this.type=function(g){if(g){b=g}return b};if(d){b=d}var e={};this.currentTarget=function(g){if(g){e=g}return e};var c=new Object();this.data=function(g){if(g){c=g}return c};if(f){c=f}var a;this.target=function(g){if(g){a=g}return a}}var defaultAdEvents=["INIT","LOAD","REMOVE","SHOW","HIDE","PROGRESS","TRACK","COUNT","CLICK","PRIVACY_CLICK","PRIVACY_OPEN","PRIVACY_CLOSE"];AdEvent.list=new Object();AdEvent.check=function(b){for(var a in AdEvent.list){if(AdEvent.list[a]==b){return true}}log("Ad Event type is not valid: "+b,"AdEvent");return false};AdEvent.map=function(a){AdEvent.list[a]="AdEvent."+a;AdEvent[a]="AdEvent."+a};for(var dae=0;dae<defaultAdEvents.length;dae++){AdEvent.map(defaultAdEvents[dae])}AbstractPlayer=(function(h,m){var f={};var l;f.uid=function(n){if(n){l=n}return l};f.uid(h);var g;f.adDomElement=function(n){if(n){g=n}return g};f.adDomElement(m);var d=new Object();f.adEventListObj=function(){return d};var c=false;f.isLoaded=function(n){if(n===true){c=n}return c};var j=false;f.isPrivacyPanelEnabled=function(n){if(n===true){j=n}return j};var k=true;f.isAdChoiceEnabled=function(n){if(n===false){k=n}return k};var b=null;f.adWidth=function(n){if(n){b=n;this.adDomElement().style.width=b+"px"}return b};var a=null;f.adHeight=function(n){if(n){a=n;this.adDomElement().style.height=a+"px"}return a};var e=[];f.privacyInfoList=function(){return e};f.addEventListener=function(n,o){};f.removeEventListener=function(n,p,o){};f.addTrackingPixel=function(n,o,p){};f.removeTrackingPixel=function(n,o){};f.track=function(o,n){};f.addPrivacyInfo=function(n,r,q,p,o){};f.enableAdChoice=function(n,p,r,q,o){};f.disableAdChoice=function(){};f.showPrivacyInfo=function(){};f.hidePrivacyInfo=function(){};f.setPosition=function(n){};return f});var DefaultPlayer=(function(c,a){var d=new AbstractPlayer(c,a);d.addEventListener=function(e,g){if(!AdEvent.check(e)){return}if(!d.adEventListObj()[e]){d.adEventListObj()[e]=[]}for(var f=0;f<d.adEventListObj()[e].length;f++){if(d.adEventListObj()[e][f]==g){return}}d.adEventListObj()[e].push(g)};d.removeEventListener=function(e,h,f){if(!AdEvent.check(e)){return}if(d.adEventListObj()[e]){for(var g=0;g<d.adEventListObj()[e].length;g++){if(f){if(f==d.adEventListObj()[e][g].uidName){d.adEventListObj()[e].splice(g,1);break}}else{if(d.adEventListObj()[e][g]==h){d.adEventListObj()[e].splice(g,1);break}}}if(d.adEventListObj()[e].length==0){delete d.adEventListObj()[e]}}};d.addTrackingPixel=function(e,f,h){if(!AdEvent.check(e)){return}if(h===undefined){h=true}if(f){function g(j){var k=new URLRequest(f);k.load();if(!h){d.removeEventListener(j.type(),g)}}g.url=f;g.repeat=h;d.addEventListener(e,g,false)}else{log("Parameter 'url' must be defined","addTrackingEvent")}};d.removeTrackingPixel=function(e,h){if(!AdEvent.check(e)){return}if(d.adEventListObj()[e]){var f=d.adEventListObj()[e].length;var j=0;var g=0;do{if(h){if(d.adEventListObj()[e][g].name=="defaultTrackCallBack"){if(d.adEventListObj()[e][g].url){if(d.adEventListObj()[e][g].url==h){d.adEventListObj()[e].splice(g,1);if(d.adEventListObj()[e].length==0){delete d.adEventListObj()[e];return}}}}}if(d.adEventListObj()[e]){j=f-d.adEventListObj()[e].length;f=d.adEventListObj()[e].length}else{f=0}if(j==0){g++}}while(g<f)}};d.track=function(m,h,j){try{if(!AdEvent.check(m.type())){return}}catch(l){return}if(d.adEventListObj()[m.type()]){var f=d.adEventListObj()[m.type()].length;var n=0;var g=0;do{m.target(d);if(j){m.currentTarget(j)}else{m.currentTarget(d)}if(h){m.data().url=h}d.adEventListObj()[m.type()][g](m);if(d.adEventListObj()[m.type()]){n=f-d.adEventListObj()[m.type()].length;f=d.adEventListObj()[m.type()].length}else{f=0}if(n==0){g++}}while(g<f)}if(h){var k=new URLRequest(h);k.load()}};d.addPrivacyInfo=function(e,k,j,h,f){var g=new PrivacyInfo();g.adServer=e;g.message=k;if(!h||h==""){h="Opt Out"}g.urlText=h;g.url=j;d.privacyInfoList().push(g);if(f!==false){d.enableAdChoice()}};d.privacyInfoBtn;d.privacyPanel;d.iconPos="top-right";d.enableAdChoice=function(e,g,j,h,f){if(!d.privacyPanel){d.privacyPanel=new PrivacyPanel(d.privacyInfoList(),g,j,h,d.toggle,d.track)}else{d.privacyPanel.infoList(d.privacyInfoList());d.privacyPanel.closeTxt(g);d.privacyPanel.headerTxt(j);d.privacyPanel.footerTxt(h)}if(!d.privacyInfoBtn){d.adDomElement().style.position="relative";d.privacyInfoBtn=new PrivacyInfoButton(d.toggle,e);if(f){d.iconPos=f}d.setPosition(d.iconPos)}else{d.privacyInfoBtn.openBtnTxt(e)}if((d.isAdChoiceEnabled()===true)&&(d.privacyInfoList().length>0)){d.adDomElement().appendChild(d.privacyInfoBtn.button)}};var b=false;d.toggle=function(){if(!b){b=true;d.showPrivacyInfo()}else{b=false;d.hidePrivacyInfo()}};d.setPosition=function(e){if(d.privacyInfoBtn){d.privacyInfoBtn.setPosition(e);d.privacyPanel.setPosition(e)}else{d.enableAdChoice(null,null,null,null,e)}};d.disableAdChoice=function(){d.isAdChoiceEnabled(false);d.adDomElement().removeChild(d.privacyInfoBtn.button)};d.showPrivacyInfo=function(){d.adDomElement().appendChild(d.privacyPanel.panel);d.isPrivacyPanelEnabled(true);d.track(new AdEvent(AdEvent.PRIVACY_OPEN))};d.hidePrivacyInfo=function(){if(d.privacyPanel){d.isPrivacyPanelEnabled(false);d.adDomElement().removeChild(d.privacyPanel.panel);d.track(new AdEvent(AdEvent.PRIVACY_CLOSE))}};return d});var ReferencePlayer=(function(d,a,c){var f=new AbstractPlayer(d,a);var b=new DefaultPlayer(d,a);function e(h,g){b[h].apply(f,g);c[h].apply(f,g)}f.addEventListener=function(g,h){e("addEventListener",[g,h,this])};f.removeEventListener=function(g,j,h){e("removeEventListener",[g,j,h,this])};f.addTrackingPixel=function(g,h,j){e("addTrackingPixel",[g,h,j,this])};f.removeTrackingPixel=function(g,h){e("removeTrackingPixel",[g,h,this])};f.track=function(j,g,h){e("track",[j,g,h,this])};f.addPrivacyInfo=function(g,l,k,j,h){b.isAdChoiceEnabled(false);e("addPrivacyInfo",[g,l,k,j,h,this])};f.enableAdChoice=function(g,j,l,k,h){b.isAdChoiceEnabled(false);e("enableAdChoice",[g,j,l,k,h,this])};f.showPrivacyInfo=function(){e("showPrivacyInfo",[this])};f.hidePrivacyInfo=function(){e("hidePrivacyInfo",[this])};f.setPosition=function(g){e("setPosition",[g,this])};return f});var IframePlayer=(function(d,a){var g=new AbstractPlayer(d,a);var c=new DefaultPlayer(d,a);function f(j,h){return c[j].apply(g,h)}function b(k,l,j){var h=["postType:"+PostMessage.OUTGOING,"uid:"+d,"fn:"+k,"params:"+l.toString()];if(j){h=h.concat(j)}PostMessage.send(h,parent)}function e(h){var j=h.replace(/\s+/g," ");if(j.search(/function /i,"")==0){funcStartPos=j.search(/function /i,"");funcEndPos=0;funcLen=9;funcEndPos=funcStartPos+funcLen;startPos=funcEndPos;endPos=j.search(/\(/)}else{if(j.search(/var /i,"")==0){varLen=4;startPos=4}else{varLen=0;startPos=0}endPos=j.search(/\=/)}funcName=j.substring(startPos,endPos).replace(/\s+/g,"");return escape(PostMessage.FUNCTION+funcName)}g.uid=function(h){return f("uid",[h])};g.adDomElement=function(h){return f("adDomElement",[h])};g.adDomElement(a);g.adEventListObj=function(){return f("adEventListObj",[null])};g.isLoaded=function(h){return f("isLoaded",[h])};g.isPrivacyPanelEnabled=function(h){return f("isPrivacyPanelEnabled",[h])};g.isAdChoiceEnabled=function(h){return f("isAdChoiceEnabled",[h])};g.adWidth=function(h){return f("adWidth",[h])};g.adHeight=function(h){return f("adHeight",[h])};g.privacyInfoList=function(){return f("privacyInfoList",[null])};g.addEventListener=function(h,j){j.uidName=d+new Date().getTime();f("addEventListener",[h,j,this]);b("addEventListener",[h,e(j.toString())],["uidName:"+j.uidName])};g.removeEventListener=function(h,k,j){f("removeEventListener",[h,k,j,this]);b("removeEventListener",[h,e(k.toString())],["uidName:"+k.uidName])};g.addTrackingPixel=function(h,j,l){if(!AdEvent.check(h)){return}if(l===undefined){l=true}if(j){function k(m){var n=new URLRequest(j);n.load();if(!l){g.removeEventListener(m.type(),k)}}k.url=j;k.repeat=l;this.addEventListener(h,k,false)}else{log("Parameter 'url' must be defined","addTrackingEvent")}};g.removeTrackingPixel=function(h,l){if(!AdEvent.check(h)){return}if(this.adEventListObj()[h]){var j=this.adEventListObj()[h].length;var m=0;var k=0;do{if(l){if(this.adEventListObj()[h][k].name=="defaultTrackCallBack"){if(this.adEventListObj()[h][k].url){if(this.adEventListObj()[h][k].url==l){this.adEventListObj()[h].splice(k,1);if(this.adEventListObj()[h].length==0){delete this.adEventListObj()[h];return}}}}}if(this.adEventListObj()[h]){m=j-this.adEventListObj()[h].length;j=this.adEventListObj()[h].length}else{j=0}if(m==0){k++}}while(k<j)}};g.track=function(k,h,j){f("track",[k,h,j,this]);b("track",[k.type(),h,"null"])};g.addPrivacyInfo=function(h,m,l,k,j){f("addPrivacyInfo",[h,m,l,k,j,this]);b("addPrivacyInfo",[h,m,l,k,j])};g.disableAdChoice=function(){f("disableAdChoice",[])};g.enableAdChoice=function(h,k,m,l,j){f("enableAdChoice",[h,k,m,l,j]);b("enableAdChoice",[h,k,m,l,j])};g.showPrivacyInfo=function(){f("showPrivacyInfo",[this]);b("showPrivacyInfo",[null])};g.hidePrivacyInfo=function(){f("hidePrivacyInfo",[this]);b("hidePrivacyInfo",[null])};g.setPosition=function(h){f("setPosition",[h,this]);b("setPosition",[h,null])};return g});var PlayerFactory=(function(uid,domRefId,fnInit,refAdPlayer){var _this={};if(!uid){log("Unique ID is required.","AdPlayer");return}var _isInIFrame=(window.location!=window.parent.location)?true:false;function init(){if(domRefId&&!refAdPlayer){if(checkAdMgrDomList(domRefId)){onReady("AdPlayerManager.getAdPlayerById(domRefId)",_this,domRefAdPlayerInit,[domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],true)}else{addToAdMgrList(domRefId);if(AdPlayerManager.isSearching()){onReady("document.getElementById(domRefId)",_this,parentDomSearch,[uid,domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],true)}else{onReady("document.getElementById(domRefId)",_this,parentDomSearch,[uid,domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],false)}}}else{if(domRefId&&refAdPlayer){if(checkAdMgrDomList(domRefId)){onReady("refAdPlayer",_this,refAdPlayerInit,[refAdPlayer,uid,domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],false)}else{addToAdMgrList(domRefId);onReady("document.getElementById(domRefId)",_this,refAdPlayerInit,[refAdPlayer,uid,domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],false)}}else{if(!domRefId&&refAdPlayer){domRefId=setDocWriteRef();addToAdMgrList(domRefId);onReady("document.getElementById(domRefId)",_this,refAdPlayerInit,[refAdPlayer,uid,domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],true)}else{if(!domRefId&&!refAdPlayer){domRefId=setDocWriteRef();if(checkAdMgrDomList(domRefId)){onReady("AdPlayerManager.getAdPlayerById(domRefId)",_this,domRefAdPlayerInit,[domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],true)}else{addToAdMgrList(domRefId);if(AdPlayerManager.isSearching()){onReady("document.getElementById(domRefId)",_this,parentDomSearch,[uid,domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],true)}else{onReady("document.getElementById(domRefId)",_this,parentDomSearch,[uid,domRefId,fnInit],returnDefault,[uid,domRefId,fnInit],false)}}}}}}}function refAdPlayerInit(refPlayer,uid,domRefId,fnInit){if(document.getElementById(domRefId)){fnInit(new ReferencePlayer(uid,document.getElementById(domRefId),refPlayer))}else{fnInit(new ReferencePlayer(uid,refPlayer.adDomElement(),refPlayer))}}function domRefAdPlayerInit(domRefId,fnInit){fnInit(AdPlayerManager.getAdPlayerById(domRefId))}function checkAdMgrDomList(domRef){var isListed=false;for(var i=0;i<AdPlayerManager.domIdList().length;i++){if(AdPlayerManager.domIdList()[i]==domRef){isListed=true;break}}return isListed}function addToAdMgrList(id){for(var i=0;i<AdPlayerManager.domIdList().length;i++){if(AdPlayerManager.domIdList()[i]==id){return}}AdPlayerManager.domIdList().push(id)}function removeFromAdMgrList(id){for(var i=0;i<AdPlayerManager.domIdList().length;i++){if(AdPlayerManager.domIdList()[i]==id){AdPlayerManager.domIdList().splice(i,1);break}}}function parentDomSearch(uid,domRef,fnInit){AdPlayerManager.searchCount++;var par=document.getElementById(domRef).parentNode;while(!AdPlayerManager.getAdPlayerById(par.id)){par=par.parentNode;parName=par.nodeName.toLowerCase();if((parName=="body")||(parName=="html")){break}}if(par){var adPlayer=AdPlayerManager.getAdPlayerById(par.id);if(adPlayer){if(fnInit){log("Found player at "+adPlayer.adDomElement().id);fnInit(adPlayer)}AdPlayerManager.searchCount--;removeFromAdMgrList(domRef)}else{log("No AdPlayer found after parent search. Creating new player for "+uid);if(_isInIFrame){if(String(window.location).search(/apstub.html\#\{(.*?)\}/)>-1){AdPlayerManager.searchCount--;function setStub(uid,domRef){for(var i=0;i<parent.document.getElementsByTagName("iframe").length;i++){if(parent.document.getElementsByTagName("iframe")[i].contentWindow==window){var player=parent.PostMessageHandler.getPlayerByDomSearch(parent.document.getElementsByTagName("iframe")[i]);if(player){fnInit(player)}else{fnInit(new DefaultPlayer(uid,document.getElementById(domRef)))}break}}}onReady("parent.AdPlayerManager.searchCount == 0",this,setStub,[uid,domRef],returnDefault,[uid,domRefId,fnInit],true);return}var iframePlayer=new IframePlayer(uid,document.getElementById(domRef));fnInit(iframePlayer);AdPlayerManager.searchCount--;var uAdId=uid+new Date().getTime();_this.uid=function(){return uAdId};AdPlayerManager.factoryList().push(_this);var jsonArr=["postType:"+PostMessage.OUTGOING,"uid:"+_this.uid(),"fn:iframePlayerVerify"];PostMessage.send(jsonArr,parent);_this.setIframePlayerType=function(json){AdPlayerManager.searchCount--;for(var i=0;i<AdPlayerManager.list().length;i++){if(AdPlayerManager.list()[i].uid()==_this.uid()){AdPlayerManager.list().splice(i,1);break}}if(json.params=="true"){iframePlayer.disableAdChoice()}}}else{AdPlayerManager.searchCount--;fnInit(new DefaultPlayer(uid,document.getElementById(domRef)))}removeFromAdMgrList(domRef)}}}function returnDefault(uid,domRef,fnInit){fnInit(new DefaultPlayer(uid,document.getElementById(domRef)))}function setDocWriteRef(){var uAdId=new Date().getTime();log('WARNING: No valid referral element specified for "'+uid+'". Referral will be created using "document.write"',"parentDomSearch");domId="ref"+uAdId;document.write('<span id="'+domId+'"></span>');return domId}function onReady(evalStr,context,readyFn,readyParams,errorFn,errorParams,search){if(!search){search=false}function waitTimer(eStr,cTxt,rdyFn,rdyPar,errFn,errPar){AdPlayerManager.searchCount++;var _timeout=0;function check(){_timeout++;if(_timeout==100){clearInterval(_interval);AdPlayerManager.searchCount--;errFn.apply(cTxt,errorParams);return}if(eval(eStr)){clearInterval(_interval);AdPlayerManager.searchCount--;rdyFn.apply(cTxt,rdyPar);return}}var _interval=setInterval(check,100)}if(search===true){waitTimer("AdPlayerManager.isSearching() === true",this,waitTimer,[evalStr,context,readyFn,readyParams,errorFn,errorParams],errorFn,errorParams)}else{waitTimer(evalStr,context,readyFn,readyParams,errorFn,errorParams)}}init();return _this});var AdPlayer=(function(g,c,a,e){var f=new AbstractPlayer(g,null);var h=[];AdPlayerManager.searchCount++;var d;f.player=function(){return d};f.adDomElement=function(l){return d.adDomElement(l)};f.adEventListObj=function(){return d.adEventListObj()};f.isLoaded=function(l){return d.isLoaded(l)};f.isPrivacyPanelEnabled=function(l){return d.isPrivacyPanelEnabled(l)};f.adWidth=function(l){return d.adWidth(l)};f.adHeight=function(l){return d.adHeight(l)};f.privacyInfoList=function(){return d.privacyInfoList()};function k(m,l){if(!d){h.push(b(f[m],f,l));return}d[m].apply(f,l)}function b(m,l,n){return function(){m.apply(l,n)}}f.addEventListener=function(l,m){k("addEventListener",[l,m,this])};f.removeEventListener=function(l,n,m){k("removeEventListener",[l,n,m,this])};f.addTrackingPixel=function(l,m,n){k("addTrackingPixel",[l,m,n,this])};f.removeTrackingPixel=function(l,m){k("removeTrackingPixel",[l,m,this])};f.track=function(m,l){k("track",[m,l,this])};f.addPrivacyInfo=function(l,p,o,n,m){k("addPrivacyInfo",[l,p,o,n,m,this])};f.enableAdChoice=function(l,n,p,o,m){k("enableAdChoice",[l,n,p,o,m,this])};f.disableAdChoice=function(){k("disableAdChoice",[this])};f.showPrivacyInfo=function(){k("showPrivacyInfo",[this])};f.hidePrivacyInfo=function(){k("hidePrivacyInfo",[this])};f.setPosition=function(l){k("setPosition",[l,this])};function j(){var m=new PlayerFactory(g,c,l,e);function l(n){d=n;AdPlayerManager.addAdPlayer(d);if(a){a(f)}d.track(new AdEvent(AdEvent.INIT),null,f);while(h.length>0){(h.shift())()}AdPlayerManager.searchCount--}}j();return f});var AdPlayerManager=(function(){var g={};var a=[];var c=[];var e=[];g.isIE=(navigator.appVersion.indexOf("MSIE")!=-1)?true:false;g.isWin=(navigator.appVersion.toLowerCase().indexOf("win")!=-1)?true:false;g.isOpera=(navigator.userAgent.indexOf("Opera")!=-1)?true:false;g.isFF=(navigator.userAgent.indexOf("Firefox")!=-1)?true:false;function f(){}g.list=function(){return a};_factoryList=[];g.factoryList=function(){return _factoryList};var b=[];g.domIdList=function(){return b};g.searchCount=0;g.isSearching=function(h){if(g.searchCount==0){return false}else{return true}};g.addAdPlayer=function(j){for(var h=0;h<a.length;h++){if(typeof a[h].adDomElement!=="undefined"){if(a[h].adDomElement().id==j.adDomElement().id){return}}}a.push(j);d(j)};g.register=function(h){c.push(h)};g.unregister=function(j){for(var h=0;h<c.length;h++){if(c[h]==j){c.shift(h,1);return}}};g.getAdPlayerById=function(j){for(var h=0;h<a.length;h++){if(typeof a[h].adDomElement!=="undefined"){if(a[h].adDomElement().id==j){return a[h]}}else{log("DOM element is not properly specified.","getPlayerById")}}return null};g.getPlayerByDomElement=function(j){for(var h=0;h<a.length;h++){if(a[h].adDomElement()){if(a[h].adDomElement()==j){return a[h]}}else{log("DOM element is not properly specified.","getPlayerByDomElement")}}return null};g.getPlayerByUID=function(j){for(var h=0;h<a.length;h++){if(a[h].uid()){if(a[h].uid()==j){return a[h]}}}return null};function d(k){var h=c.length;var l=0;var j=0;do{if(typeof c[j]=="function"){c[j](k)}if(c>0){l=h-c.length;h=c.length}else{h=0}if(l==0){j++}}while(j<h)}g.setClassName=function(h,j){h.setAttribute("class",j);if(g.isIE){h.setAttribute("className",j)}};f();return g})()};